---
# joe-speedboat.graylog/defaults/main.yml

# --- RPM VERSIONs ---
graylog_version: "6.3"
mongodb_version: "7.0"

# apply role even if graylog exist
reconfigure_graylog: False

# --- GENERAL CONFIG ---
graylog_hostname: "{{ ansible_fqdn }}"
graylog_root_email: "graylogadmin@example.com"
graylog_admin_password: "graylog"
graylog_root_timezone: "Europe/Zurich"
graylog_allow_highlighting: true
graylog_dashboard_widget_default_cache_time: 60s
graylog_cluster_name: "graylog"
graylog_mongodb_uri: "mongodb://localhost/{{ graylog_cluster_name }}"
graylog_http_bind_address: '127.0.0.1:9000'
graylog_is_master: true

# nginx rp vars
nginx_ssl_rp_path: /
nginx_proxy_pass_url: 'http://{{ graylog_http_bind_address }}'
nginx_ssl_cert_dir: /etc/nginx
nginx_ssl_cert_days: 3650
nginx_ssl_cert_host: "{{ ansible_fqdn }}"
nginx_ssl_cert_key: "{{ nginx_ssl_cert_host }}_key.pem"
nginx_ssl_cert_crt: "{{ nginx_ssl_cert_host }}_crt.pem"
nginx_ssl_cert_ca_chain: "{{ nginx_ssl_cert_host }}_ca_chain.pem"
nginx_ssl_cert_dhparam: "{{nginx_ssl_cert_host}}_dhparam.pem"


# --- MAIL CONFIG ---
graylog_transport_email_enabled: false
graylog_transport_email_hostname: mail.example.com
graylog_transport_email_port: 25
graylog_transport_email_use_auth: false
graylog_transport_email_use_tls: false
graylog_transport_email_use_ssl: false
graylog_transport_email_auth_username: "you@example.com"
graylog_transport_email_auth_password:  "secret"
graylog_transport_email_subject_prefix: "[graylog]"
graylog_transport_email_from_email: "graylog@example.com"

# --- MEMORY SETTINGS ---
total_ram_gb: "{{ (ansible_facts['memtotal_mb'] / 1024) | round(0, 'floor') | int }}"
# OS reserved memory
reserved_os_gb: 2
# 50 % for Elastic
graylog_dataserver_memory_gb: "{{ (total_ram_gb | int / 2 | round(0, 'floor')) | int }}"
# 2/3 of the rest for graylog server
graylog_server_memory_gb: "{{ ((total_ram_gb | int - reserved_os_gb | int - graylog_dataserver_memory_gb | int) * 0.6666) | round(0, 'floor') | int }}"
# rest for mongodb
graylog_mongodb_memory_gb: "{{ (total_ram_gb | int - reserved_os_gb | int - graylog_dataserver_memory_gb | int - graylog_server_memory_gb | int) | round(0, 'floor') | int }}"

...
